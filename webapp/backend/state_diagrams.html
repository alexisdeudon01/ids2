<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Diagrammes d'√âtat - Syst√®me IDS2</title>
    <script src="https://cdn.jsdelivr.net/npm/mermaid@10.6.1/dist/mermaid.min.js"></script>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
            background: #f5f5f5;
        }
        h1 {
            color: #2c3e50;
            text-align: center;
            border-bottom: 3px solid #3498db;
            padding-bottom: 10px;
        }
        h2 {
            color: #34495e;
            margin-top: 40px;
            border-left: 4px solid #3498db;
            padding-left: 15px;
        }
        .diagram-container {
            background: white;
            border-radius: 8px;
            padding: 20px;
            margin: 20px 0;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .mermaid {
            text-align: center;
            background: white;
        }
        .legend {
            background: #ecf0f1;
            padding: 15px;
            border-radius: 5px;
            margin: 20px 0;
        }
        .legend h3 {
            margin-top: 0;
            color: #2c3e50;
        }
        .legend ul {
            list-style-type: none;
            padding-left: 0;
        }
        .legend li {
            padding: 5px 0;
            border-bottom: 1px solid #bdc3c7;
        }
        .legend li:last-child {
            border-bottom: none;
        }
    </style>
</head>
<body>
    <h1>üìä Diagrammes d'√âtat - Syst√®me IDS2</h1>

    <h2>1. Diagramme d'√âtat Principal (Agent Supervisor)</h2>
    <div class="diagram-container">
        <div class="mermaid">
stateDiagram-v2
    [*] --> Initializing: D√©marrage
    
    state Initializing {
        [*] --> LoadingConfig
        LoadingConfig --> ValidatingConfig: Config charg√©
        ValidatingConfig --> ConfigValid: Validation OK
        ValidatingConfig --> ConfigError: Validation √©chou√©e
        ConfigValid --> [*]
        ConfigError --> [*]
    }
    
    Initializing --> ConfigError: Config invalide
    Initializing --> ComponentsStarting: Config valide
    
    state ComponentsStarting {
        [*] --> StartingResourceController
        StartingResourceController --> StartingDockerManager: ResourceController OK
        StartingDockerManager --> StartingSuricataManager: DockerManager OK
        StartingSuricataManager --> AllComponentsStarted: SuricataManager OK
        AllComponentsStarted --> [*]
    }
    
    ComponentsStarting --> Running: Tous les composants d√©marr√©s
    ComponentsStarting --> Error: √âchec d√©marrage composant
    
    state Running {
        [*] --> Monitoring
        Monitoring --> CheckingHealth: V√©rification p√©riodique
        CheckingHealth --> NormalOperation: Tous OK
        CheckingHealth --> ComponentIssue: Probl√®me d√©tect√©
        NormalOperation --> Monitoring: Cycle normal
        ComponentIssue --> Monitoring: Probl√®me r√©solu
        ComponentIssue --> ResourceLimitExceeded: Limite atteinte
    }
    
    Running --> Monitoring: Op√©ration normale
    Monitoring --> Running: Tout OK
    Monitoring --> Degraded: Probl√®me composant
    Monitoring --> Error: √âchec critique
    
    state Degraded {
        [*] --> DetectingIssue
        DetectingIssue --> AttemptingRecovery: Auto-r√©paration
        AttemptingRecovery --> RecoverySuccess: R√©paration r√©ussie
        AttemptingRecovery --> RecoveryFailed: R√©paration √©chou√©e
        RecoverySuccess --> [*]
        RecoveryFailed --> [*]
    }
    
    Degraded --> Recovering: Auto-r√©paration
    Recovering --> Running: R√©paration r√©ussie
    Recovering --> Error: R√©paration √©chou√©e
    
    state Error {
        [*] --> CriticalFailure
        CriticalFailure --> LoggingError
        LoggingError --> DeterminingAction
        DeterminingAction --> [*]
    }
    
    Error --> Restarting: Red√©marrage manuel/auto
    Restarting --> Initializing: Red√©marrage complet
    
    state Stopping {
        [*] --> StoppingSuricata
        StoppingSuricata --> StoppingDocker: Suricata arr√™t√©
        StoppingDocker --> StoppingResourceController: Docker arr√™t√©
        StoppingResourceController --> AllStopped: ResourceController arr√™t√©
        AllStopped --> [*]
    }
    
    Running --> Stopping: Commande arr√™t
    Degraded --> Stopping: Commande arr√™t
    Monitoring --> Stopping: Commande arr√™t
    Error --> Stopping: Commande arr√™t (si possible)
    
    Stopping --> Stopped: Tout arr√™t√©
    Stopped --> [*]: Sortie
    Stopped --> Initializing: Commande red√©marrage
    
    ConfigError --> [*]: Sortie
    Error --> [*]: Erreur fatale
        </div>
    </div>

    <h2>2. Diagramme d'√âtat des Composants</h2>
    <div class="diagram-container">
        <div class="mermaid">
stateDiagram-v2
    [*] --> Stopped: Composant cr√©√©
    
    Stopped --> Starting: demarrer() appel√©
    Starting --> Running: D√©marrage r√©ussi
    Starting --> Error: √âchec d√©marrage
    
    Running --> Monitoring: Op√©ration normale
    Monitoring --> Healthy: Sant√© OK
    Monitoring --> Unhealthy: Probl√®me d√©tect√©
    
    Healthy --> Monitoring: Cycle de v√©rification
    Unhealthy --> AttemptingRecovery: Tentative r√©cup√©ration
    AttemptingRecovery --> Healthy: R√©cup√©ration r√©ussie
    AttemptingRecovery --> Degraded: R√©cup√©ration partielle
    AttemptingRecovery --> Error: R√©cup√©ration √©chou√©e
    
    Degraded --> AttemptingRecovery: Nouvelle tentative
    Degraded --> Error: Probl√®me critique
    
    Running --> Stopping: arreter() appel√©
    Monitoring --> Stopping: Commande arr√™t
    Healthy --> Stopping: Commande arr√™t
    Unhealthy --> Stopping: Commande arr√™t
    Degraded --> Stopping: Commande arr√™t
    Error --> Stopping: Commande arr√™t (si possible)
    
    Stopping --> Stopped: Arr√™t complet
    Stopped --> [*]: Destruction
        </div>
    </div>

    <h2>3. Diagramme d'√âtat du Pipeline</h2>
    <div class="diagram-container">
        <div class="mermaid">
stateDiagram-v2
    [*] --> Unknown: Pipeline initialis√©
    
    Unknown --> Collecting: Collecte des statuts
    Collecting --> Processing: Statuts collect√©s
    
    Processing --> OK: Tous les composants sains
    Processing --> Degraded: Certains composants en erreur
    Processing --> KO: Tous les composants en erreur
    
    OK --> Collecting: Cycle de collecte
    Degraded --> Collecting: Cycle de collecte
    KO --> Collecting: Cycle de collecte
    
    OK --> Degraded: Probl√®me d√©tect√©
    Degraded --> OK: Probl√®me r√©solu
    Degraded --> KO: Probl√®me critique
    
    KO --> Recovering: Tentative r√©cup√©ration
    Recovering --> Degraded: R√©cup√©ration partielle
    Recovering --> OK: R√©cup√©ration compl√®te
    Recovering --> KO: R√©cup√©ration √©chou√©e
        </div>
    </div>

    <h2>4. Diagramme d'√âtat du D√©ploiement</h2>
    <div class="diagram-container">
        <div class="mermaid">
stateDiagram-v2
    [*] --> NotStarted: D√©ploiement initialis√©
    
    NotStarted --> CheckingPrerequisites: D√©marrage
    CheckingPrerequisites --> PrerequisitesOK: Pr√©requis valid√©s
    CheckingPrerequisites --> PrerequisitesFailed: Pr√©requis manquants
    
    PrerequisitesOK --> InstallingDependencies: Installation d√©pendances
    PrerequisitesFailed --> [*]: √âchec
    
    InstallingDependencies --> DependenciesInstalled: D√©pendances install√©es
    InstallingDependencies --> DependenciesFailed: √âchec installation
    
    DependenciesInstalled --> BuildingDockerImages: Build images Docker
    DependenciesFailed --> [*]: √âchec
    
    BuildingDockerImages --> ImagesBuilt: Images construites
    BuildingDockerImages --> BuildFailed: √âchec build
    
    ImagesBuilt --> StartingServices: D√©marrage services
    BuildFailed --> [*]: √âchec
    
    StartingServices --> ServicesStarted: Services d√©marr√©s
    StartingServices --> ServicesFailed: √âchec d√©marrage
    
    ServicesStarted --> VerifyingHealth: V√©rification sant√©
    ServicesFailed --> [*]: √âchec
    
    VerifyingHealth --> HealthOK: Sant√© OK
    VerifyingHealth --> HealthFailed: Sant√© √©chou√©e
    
    HealthOK --> Deployed: D√©ploiement r√©ussi
    HealthFailed --> Retrying: Nouvelle tentative
    
    Retrying --> StartingServices: Retry
    Retrying --> [*]: Max tentatives atteint
    
    Deployed --> [*]: Succ√®s
        </div>
    </div>

    <h2>5. Diagramme d'√âtat des Services Docker</h2>
    <div class="diagram-container">
        <div class="mermaid">
stateDiagram-v2
    [*] --> NotCreated: Service non cr√©√©
    
    NotCreated --> Creating: Cr√©ation conteneur
    Creating --> Created: Conteneur cr√©√©
    Creating --> CreationFailed: √âchec cr√©ation
    
    Created --> Starting: D√©marrage
    Starting --> Running: Service d√©marr√©
    Starting --> StartFailed: √âchec d√©marrage
    
    Running --> Healthy: Health check OK
    Running --> Unhealthy: Health check √©chou√©
    Running --> Stopping: Commande arr√™t
    
    Healthy --> Running: Cycle normal
    Unhealthy --> Restarting: Red√©marrage automatique
    Unhealthy --> Stopping: Arr√™t manuel
    
    Restarting --> Starting: Nouveau d√©marrage
    Restarting --> RestartFailed: √âchec red√©marrage
    
    Stopping --> Stopped: Service arr√™t√©
    Stopped --> Removing: Suppression
    Removing --> [*]: Supprim√©
    
    CreationFailed --> [*]: √âchec fatal
    StartFailed --> [*]: √âchec fatal
    RestartFailed --> [*]: √âchec fatal
        </div>
    </div>

    <div class="legend">
        <h3>üìã L√©gende des √âtats</h3>
        <h4>√âtats Principaux</h4>
        <ul>
            <li><strong>Initializing</strong>: Initialisation du syst√®me</li>
            <li><strong>ComponentsStarting</strong>: D√©marrage des composants</li>
            <li><strong>Running</strong>: Syst√®me en fonctionnement</li>
            <li><strong>Monitoring</strong>: Surveillance active</li>
            <li><strong>Degraded</strong>: Syst√®me d√©grad√© mais fonctionnel</li>
            <li><strong>Recovering</strong>: R√©cup√©ration en cours</li>
            <li><strong>Error</strong>: Erreur critique</li>
            <li><strong>Stopping</strong>: Arr√™t en cours</li>
            <li><strong>Stopped</strong>: Arr√™t√©</li>
        </ul>
        <h4>√âtats des Composants</h4>
        <ul>
            <li><strong>Stopped</strong>: Composant arr√™t√©</li>
            <li><strong>Starting</strong>: D√©marrage en cours</li>
            <li><strong>Running</strong>: En fonctionnement</li>
            <li><strong>Monitoring</strong>: Surveillance active</li>
            <li><strong>Healthy</strong>: Sant√© OK</li>
            <li><strong>Unhealthy</strong>: Probl√®me d√©tect√©</li>
            <li><strong>AttemptingRecovery</strong>: Tentative de r√©cup√©ration</li>
            <li><strong>Degraded</strong>: √âtat d√©grad√©</li>
            <li><strong>Error</strong>: Erreur</li>
        </ul>
        <h4>√âtats du Pipeline</h4>
        <ul>
            <li><strong>Unknown</strong>: √âtat inconnu</li>
            <li><strong>Collecting</strong>: Collecte des statuts</li>
            <li><strong>Processing</strong>: Traitement des statuts</li>
            <li><strong>OK</strong>: Tous les composants sains</li>
            <li><strong>Degraded</strong>: Certains composants en erreur</li>
            <li><strong>KO</strong>: Tous les composants en erreur</li>
            <li><strong>Recovering</strong>: R√©cup√©ration en cours</li>
        </ul>
    </div>

    <script>
        mermaid.initialize({ 
            startOnLoad: true,
            theme: 'default',
            themeVariables: {
                primaryColor: '#3498db',
                primaryTextColor: '#fff',
                primaryBorderColor: '#2980b9',
                lineColor: '#34495e',
                secondaryColor: '#ecf0f1',
                tertiaryColor: '#95a5a6'
            }
        });
    </script>
</body>
</html>
